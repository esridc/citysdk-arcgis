---
layout: default
---

<div class="container">
<!-- Example row of columns -->
<div class="row">
  <div class="col-md-6">
    <h2>GeoEnrichment</h2>
    <p>Compare local government data with US Census ACS indicators.</p>
    <div class="">
      <input class="form-control" type="text" id="service-url" value="http://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/CDW_Feeds/MapServer/0" /><br />
      <textarea class="form-control" id="service-where" rows=4>[
    "LICENSESTATUS='ACTIVE'",
    "ANC='6A'"
]</textarea>
<br/>
      <select id="service-variable" class="input-lg">
        <option value="income" default>Median Income</option>
        <option value="age">Age</option>
        <option value="population">Population</option>
        <option value="commute_time">Commute Time</option>
      </select>
    
    <a class="btn btn-default btn-lg" role="button" href="#" onclick="runDemo()"> 
        <span class="glyphicon glyphicon-play"></span> Run Demo</a>
    </div>
    <hr>
    <br />
    <h3>Example Code</h3>
    <pre>
var sdk = new CitySDK();
var arcgis = sdk.modules.arcgis;
var census = sdk.modules.census;    
service = { 
  "url": "http://maps2.dcgis.dc.gov/dcgis/rest/services/FEEDS/CDW_Feeds/MapServer/0",
  "where": [
      "LICENSESTATUS='ACTIVE'",
      "ANC='6A'"
  ]
};
arcgis.APIRequest(service, function(response) {
  $.map(response.features, function(feature,i) {
    var request = {
      "lat": feature.geometry.y,
      "lng": feature.geometry.x,
      "level": "tract",
      "container": "place",
      "variables": [
        "income"
      ]
    };

    var callback = function(response) {
        $('#output-table  tr:last').after(
            '<tr><td>' + feature.attributes[response.displayFieldName] + '</td>' +
            '<td>' + response.data[0].income +'</td></tr>'
        );                        
    };

    census.APIRequest(request, callback);
  });
});

    </pre>
  </div>
  <div class="col-md-6">
    <div id="output" class="table-responsive">
      
    </div>
 </div>
</div>
</div>

<script type="text/javascript">
  var sdk = new CitySDK();
  var arcgis = sdk.modules.arcgis;
  var census = sdk.modules.census;
  var variable, where, url;
  census.enable("d9084c5c4a0e92c442406b5eae0f14ec71d83569");
  function runDemo() {
    url = $('#service-url').val();
    where = JSON.parse($('#service-where').val());
    variable = $('#service-variable').val();
    console.log("Census Variable", variable);

    if(where.length == 0){
      where = ["1=1"];
    }
    citySDKArcGIS_Table({ 
            "url": url,
            "where": where
        });
  }

  function citySDKArcGIS_Table(request) {
      $("#output").html('<table class="table table-striped" id="output-table"> <thead><tr><td>Name</td><td>ACS ' 
        +  $('#service-variable option:selected').text() +'</td></tr></thead> </table>');
      arcgis.APIRequest(request, function(service) {
          $.map(service.features, function(feature,i) {
              var request = {
                  "lat": feature.geometry.y,
                  "lng": feature.geometry.x,
                  "level": "blockGroup",
                  "variables": [
                      variable
                  ]
              };
              console.log("Request", request)

              var callback = function(response) {
                  $('#output-table  tr:last').after(
                      '<tr><td>' + feature.attributes[service.displayFieldName] + '</td>' +
                      '<td>' + response.data[0][variable] +'</td></tr>'
                  );                        
              };

              census.APIRequest(request, callback);
          });
          
      });
  };  
</script>
